<html>	
  <link rel="stylesheet" href="styles.css">
  <link rel = "icon" href = "./icon.png">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <title>Search Bathrooms</title>
  <header>
    <div class="container">
      <h1 class="logo"></h1>

      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li ><a href='/login' id="checkForLogin">Sign in</a></li>
          <li><a href="/searchBathrooms">Search Bathrooms</a></li>
          <li><a href="/quiz">Search Restaurants</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <head>
    <div id = "myTitle" >
      <p>Search Bathrooms</p>
    </div>
  </head>

  
  <input type ="submit" id = "myButton" onclick = "asd(1)" value="Use your current location" >
  <input type ="submit" id = "myButton" onclick = "asd(2)" value="Search for something specific" >

  <form id="currLocationForm" action="">
    <input type="button" id ="getCurrLoc" onclick = "myLocation()" value="Find nearby bathrooms">
    <input type="button" id ="clearCurrLocResults" onclick = "myClearResults()" value="Clear results">
  </form>
  <form id="searchQueryForm" action="">
    <input type="text" id="myQuery" placeholder="Ex: near vancouver">
    <input type ="button" id ="searchQuery" onclick = "searchMyQuery()" value = "Search">
    <input type ="button" id ="clearSearch" onclick = "myClearResults2()" value = "Clear results">
  </form>
  </body>

<script>
  let theUser = "";
  window.onload = function() {
    document.getElementById("currLocationForm").style.display = "none";
    document.getElementById("searchQueryForm").style.display = "none";
    fetch('/isLoggedIn')
    .then(res => res.json())
    .then(text => {
      if(text.message == false) {
        return;
      }else {
        theUser = text.myUser;
        document.getElementById("checkForLogin").innerHTML = `<a href='/logoutsearchBathrooms'>Logged in as: ${text.myUser}</a>`
      }
    })
  };

  function myClearResults() {
    document.getElementById('currLocationForm').innerHTML = "<form id=\"currLocationForm\" action style=\"display: block;\"\> <input type=\"button\" id=\"getCurrLoc\" onclick = \"myLocation()\" value=\"Find nearby bathrooms\"> <input type=\"button\" id=\"clearCurrLocResults\" onclick = \"myClearResults()\"value=\"Clear results\">" ;
  }

  function asd(a) {
    let x = document.getElementById("currLocationForm").style;
    let y = document.getElementById("searchQueryForm").style;
  if (a == 1 ) {
    x.display = "block";
    y.display = "none";
  } else if (a == 2) {
    y.display = "block";
    x.display = "none";
  }
  else {
    document.getElementById("asd").style.display = "none";
  }
  }
  function getCurrentLocation(callback) {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(callback);
    } else {
      document.getElementById("getCurrLoc").innerHTML = "Geolocation not supported";
      document.getElementById("getCurrLoc").disabled = true;
    }
  };

  function myLocation() {
    console.log("dsdsad")
    getCurrentLocation(position => {
      var currentLat = position.coords.latitude;
      var currentLon = position.coords.longitude;
      console.log(`Current latitude: ${currentLat}, Current longitude: ${currentLon}`);

      fetch(`/nearbyBathrooms${currentLat}/${currentLon}`)
      .then(response => response.json())
      .then(myText => {
        if (myText.length != 0) {
        for (i = 0; i < 10 ; i++) {
          const root = document.getElementById("currLocationForm");
          const address = document.createElement('div');
          const name = document.createElement('div');
          
          name.textContent = `Name: ${myText[i].name}`;
          address.textContent = `Address: ${myText[i].street}, ${myText[i].city}, ${myText[i].state}, ${myText[i].country}`;

          root.append(address,name);
          document.body.append(root);
        } } else {
          return;
        }
      })
    });
  };
  function searchMyQuery() {
    let myQuery = document.getElementById('myQuery').value;
    console.log(myQuery);
    if (myQuery != "") {
    fetch(`/specificQueryBathrooms${myQuery}`)
    .then(response => response.json())
      .then(myText => {
        if (myText.length != 0 ) {
        for (i = 0; i < 10 ; i++) {
          const root = document.getElementById("searchQueryForm");
          const address = document.createElement('div');
          const name = document.createElement('div');
          
          name.textContent = `Name: ${myText[i].name}`;
          address.textContent = `Address: ${myText[i].street}, ${myText[i].city}, ${myText[i].state}, ${myText[i].country}`;

          root.append(address,name);
          //document.body.append(root);
        } } else {
          return;
        }
        
      }) }
  
    } 
    function myClearResults2() {
      document.getElementById("searchQueryForm").innerHTML = "<form id =\searchQueryForm\" action> <input type=\"text\" id=\"myQuery\" placeholder=\"Ex: near vancouver\"> <input type=\"button\" id=\"searchQuery\" onclick=\"searchMyQuery()\" value=\"Search\"> <input type=\"button\" id=\"clearSearch\" onclick=\"myClearResults2()\" value=\"Clear results\">";
    }
      /*var url = 'https://www.refugerestrooms.org/api/v1/restrooms/by_location?page=1&per_page=10&offset=0&';
      var myReq = url + '&lat=' +  `${currentLat}` + '&' + '&lng=' +  `${currentLon}`;
      var myData = []
      fetch(myReq)
      .then(response => response.json())
      .then(json => { 
        for (data of json) {
          const root = document.createElement('div');
          const name = document.createElement('div');
          const address = document.createElement('div');
          name.textContent = `Name: ${data.name}`;
          address.textContent = `Address: ${data.street}, ${data.city}, ${data.state}, ${data.country}`;

          root.append(name, address);
          document.body.append(root);
        }
      })
    */
    
</script>
	
</html>