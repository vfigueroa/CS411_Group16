<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="quiz.css">
</head>
<link rel = "icon" href = "./icon.png">
<title>Search Restaurants</title>
<header>
    <div class="container">
      <h1 class="logo"></h1>

      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li id="checkForLogin"><a href="/login">Sign in</a></li>
          <li><a href="/searchBathrooms">Search Bathrooms</a></li>
          <li><a href="/quiz">Search Restaurants</a></li>
        </ul>
      </nav>
    </div>
  </header>



<body>
<div id="main"><!-- open main div -->
<div id="header"><!-- open header div -->
<h1 style="text-align:center; font-family:'Work-sans', sans-serif; color: white;">RESTAURANT QUIZ</h1>



</div><!-- close header div -->
</div><!-- close main div -->
<form id="showResultsForm" hidden="true"></form>
<form id="form1" method="POST">

<h2>What is your go-to for takeout?</h2>
<label for="take_italian"><input type="radio" name="takeout"  id="italian" />Italian (pasta?)</label>
<label for="take_chinese"><input type="radio" name="takeout"  id="chinese" />Chinese (noodle-esque?)</label>
<label for="take_mexican"><input type="radio" name="takeout"  id="mexican" />Mexican (Chipotle-esque?)</label>
<label for="take_american"><input type="radio" name="takeout"  id="american"/>American (burger?)</label>

<h2>Pick a beverage!</h2>
<label for="red_wine"><input type="radio" name="bev" id="red_wine"/>Red wine</label>
<label for="beer"><input type="radio" name="bev" id="beer"/>Beer</label>
<label for="vodka"><input type="radio" name="bev" id="vodka" />Vodka</label>
<label for="tequila"><input type="radio" name="bev" id="tequila" />Tequila</label>
<label for="none"><input type="radio" name="bev" id="none" />I don't drink</label>

<h2>What place have you always wanted to visit?</h2>
<label for="paris"><input type="radio" name="visit" id="New York" />New York</label>
<label for="dubai"><input type="radio" name="visit" id="San Francisco" />San Francisco</label>
<label for="rio"><input type="radio" name="visit" id="Miami" />Miami</label>
<label for="tokyo"><input type="radio" name="visit"  id="Boston" />Boston</label>
<label for="johan"><input type="radio" name="visit"  id="Seattle" />Seattle</label>


<h2>What is your current mood?</h2>
<label for="happy"><input type="radio" name="mood" id="happy" />Happy</label>
<label for="sad"><input type="radio" name="mood" id="sad" />Sad</label>
<label for="angry"><input type="radio" name="mood" id="angry" />Angry</label>
<label for="content"><input type="radio" name="mood"  id="content" />Content</label>
<label for="stress"><input type="radio" name="mood"  id="stress" />Stressed</label>

<h2>What guilty pleasure looks the most appealing?</h2>
<label for="burger"><input type="radio" name="guilty" id="burger" />Burger</label>
<label for="pizza"><input type="radio" name="guilty" id="pizza" />Pizza</label>
<label for="steak"><input type="radio" name="guilty" id="steak" />Steak</label>
<label for="cake"><input type="radio" name="guilty"  id="cake" />Cheesecake</label>
<label for="icecream"><input type="radio" name="guilty"  id="icecream" />Ice cream</label>

<h2>Which do you prefer?</h2>
<label for="salt"><input type="radio" name="taste" id="salt" />Salty</label>
<label for="sweet"><input type="radio" name="taste" id="sweet" />Sweet</label>
<label for="sour"><input type="radio" name="taste" id="sour" />Sour</label>
<label for="spicy"><input type="radio" name="taste"  id="spicy" />Spicy</label>

<h2>What was for breakfast?</h2>
<label for="cereal"><input type="radio" name="breakfast" id="cereal" />cereal</label>
<label for="drink"><input type="radio" name="breakfast" id="drink" />hot drink (tea/coffee)</label>
<label for="getup"><input type="radio" name="breakfast" id="getup" />Some ornate getup</label>
<label for="eggs"><input type="radio" name="breakfast"  id="eggs" />Eggs/bacon</label>
<label for="what"><input type="radio" name="breakfast"  id="what" />What's breakfast?</label>

</form>
<ul id="myButtons">
  <li><h2><button type="button" id = 'getResults' value="Submit">Submit</button></h2></li>
  <li><h2><button type="button" id = 'clearResults' value="clear">Clear Results</button></h2></li>
</ul>

</body>
<script>
  window.onload = (event) => {
    fetch('/isLoggedIn')
    .then(res => res.json())
    .then(text => {
      console.log(text);
      if(text.message == false) {
        return;
      }else {
        console.log(text.myUser);
        document.getElementById("checkForLogin").innerHTML = `<a href='/logoutquiz'>Logged in as: ${text.myUser}</a>`
      }
    })
  };
  document.getElementById('clearResults').onclick = function () {
    document.getElementById('showResultsForm').innerHTML = "";
    document.getElementById('showResultsForm').hidden = true;
    
  }
  document.getElementById('getResults').onclick = function () {
    let myTakeout = document.getElementsByName("takeout");
    let myBev = document.getElementsByName("bev");
    let myVisit = document.getElementsByName("visit");
    let myMood = document.getElementsByName("mood");
    let myGuilty = document.getElementsByName("guilty");
    let myTaste = document.getElementsByName("taste");
    let myBreakfast = document.getElementsByName("breakfast");
    let myChoices = [myTakeout, myBev, myVisit, myMood, myGuilty, myTaste, myBreakfast];
    let myChoicesFinal = [];
    for (var i = 0; i <  myChoices.length; i++) {
      for (var j = 0; j < myChoices[i].length ; j++) {
        if (myChoices[i][j].checked) {
          myChoicesFinal.push(myChoices[i][j].id)
          break;
        }
      }
    }
    console.log(myChoicesFinal);
    for (i = 0; i < myChoicesFinal.length ; i++) {
      let choice = myChoicesFinal[i];
      if (choice == "beer") myChoicesFinal[i] = "alcohol";
      if (choice == "vodka")  myChoicesFinal[i] = "alcohol";
      if (choice == "tequila") myChoicesFinal[i] = "alcohol";
      if (choice == "red_wine") myChoicesFinal[i] = "alcohol";
      if (choice == "none") myChoicesFinal[i] = "non-alcoholic";
    }
    if (myChoicesFinal.length == 7) {
      let myQuery = myChoicesFinal.slice(0,3).join('%20');
      console.log(myQuery);
      makeQuery(myChoicesFinal[0], myChoicesFinal[1], myChoicesFinal[2]);
    }else {
      alert("Please answer every question!");
    }
    
  }
function makeQuery(query1, query2, query3) {
  let myFetchReq = '/getRestaurantQuery' + query1 + '/' + query2 + '/' + query3;
  console.log(myFetchReq);
  fetch(myFetchReq)
  .then(response => response.json())
  .then(myText => {
        document.getElementById("showResultsForm").hidden = false;
        console.log(myText)
        let myD = myText.data;
        if (myText.length != 0 ) {
          const clearS = document.createElement("BUTTON");
        for (i = 0; i < 10 ; i++) {
          const root = document.getElementById("showResultsForm");
          const address = document.createElement('div');
          const name = document.createElement('div');
          
          name.textContent = `Name: ${myD[i].restaurant_name}`;
          address.textContent = `Address: ${myD[i].address.formatted}`;

          root.append(address,name);
          document.body.append(root);
          //document.body.append(root);
        } } else {
          return;
        }
        
      })
}
</script>


<style>
body {
/*background: #f6f8f8;*/
font-family: 'Work Sans', sans-serif;
font-size: 90%;
text-align: justify;
}

#main {
width: 80%;
max-width: 950px;

margin: auto;
padding: 10px;
/*background-color: blanchedalmond;*/


}

#header {
margin-top: 0;
width: 100%;
/*background: white;*/

text-align: center;

}
</style>

</body>

</html>